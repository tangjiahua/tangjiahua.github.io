---
title: 第七课：游戏支撑系统
date: 2021-04-09 17:10:00 +0800
categories: [腾讯游戏学院]
tags: [技术]
pin: true
author: Tang Jiahua

toc: true
comments: true
Typora-root-url: ..
math: false
mermaid: true


---

# 支撑系统概述

## 登录流程

### LoginServer职责

- 鉴权
- 返回服务器列表，角色信息，推荐服务器等
- 白名单（灰度服务器）和黑名单
- 基于版本好的更新控制（强制更新/推荐更新）
- 与客户端基于Session的DH密钥交换
- 登录公告

**DH密钥交换：**

![Screen Shot 2021-04-09 at 17.25.34](/assets/blog_res/2021-04-09-you-xi-zhi-cheng-xi-tong.assets/Screen%20Shot%202021-04-09%20at%2017.25.34.png)

## 其他相关技术点

### **捏脸的技术点**

方式一（image base）：游戏共随机样本，利用人脸识别技术检索最像的；

方式二（image base）：美术怼照片捏出来多个模型，AI学习；

方式三（3d base）：基于3D mesh骨骼，由照片推导基本参数，直径应用于模型

### **排行榜技术**

- 模糊排名（桶排序），非实时百分比展示排名结果，排序周期可配置，排名精度可配置
- Top N：排在前N位的榜单实时更新。N可配置。（只适合少一点的，工业一般用跳表）
- 跳表：基于链表的二分算法，可以快速增删改查。

### 语音视频服务

- 实时语音识别
- VOIP
- 直播接入（账号的直接打通）

### 动作制作

- 传统手K
- 动作捕捉
- 视频AI生成
- 高保真虚拟人

### 工会管理系统

### 报表分析

- 基于日志和实施上报，对运营状态做数据报表分析
- 以数据驱动运营调整
- 一般按天报表，对海量数据集中运算，早上8点定时推送
- 腾讯指标：
  - 登录比：第一周3留：第一周2留；（技术品质）
  - 二阶登录比：第二周来过8次的玩家：第一周来过3次的玩家；（社交体系、是否能长期存贮玩家）
  - 14LTV：一个玩家新进来以后，14天付费的数据

### 客服系统

- 对于用户投诉、查询信息的验证
- 修改数据
- 封停账号、封停角色
- 禁言、踢人
- 发邮件

### 健康系统

强化实名认证、智能打击小号、成长守护平台

### 其他

**跨服——解决数据的一致性**

**敏感词过滤——Dirty库本地维护，ac多模匹配算法**

**视野处理——**

- 九宫格：维护算法高效，无效遍历多
- 十字链表：维护有序链表性能低，但遍历平均浪费50%
- pomelo-aoi：基于订阅发布，适用于小视野游戏，效率不高

**容灾——**

- 大系统小做，单个功能出问题不影响全部
- 平行扩展，单机故障不影响整体
- 共享内存关键数据，服务器宕机数据不丢失
- 局部回档，全服回档

**Tars——**

海量服务开发框架，Linux基金会新一代海量服务开发框架。

- 快速构建，自动生成代码，持续集成
- 服务发现，容灾容错，智能调度
- ……

## 日志相关技术点

- **可配置**
  - 支持日志级别：info、debug、warn、error
  - 有开关
  - 多种记录方式支持（json、xml、写入数据库）
- **海量支持**
  - 可以滚动打印、避免刷爆硬盘（查bug用的时候，需要太多持久化）
  - 能打远程（数据库分析、快速查询），容灾处理
- **跨平台**
  - 代码级的平台无关性
- **高效，无阻塞多线程**
  - 无阻塞，不依赖IO性能
  - 支持多线程

开源框架：log4c++ / 腾讯开源Rpc框架Tars的log

## 匹配系统技术点

- 新模式新匹配规则 -> 匹配系统扩展性
- 匹配时长 -> 较长时间匹配不了，机器人
- 公平高效匹配-> elo算法、高性能
- 新人 -> 机器人引导

Elo算法：

![Screen Shot 2021-04-09 at 21.31.48](/assets/blog_res/2021-04-09-you-xi-zhi-cheng-xi-tong.assets/Screen%20Shot%202021-04-09%20at%2021.31.48.png)

## 游戏存储相关技术

![Screen Shot 2021-04-09 at 21.34.07](/assets/blog_res/2021-04-09-you-xi-zhi-cheng-xi-tong.assets/Screen%20Shot%202021-04-09%20at%2021.34.07.png)

序列化——可以减少很多内容；

压缩——降低90%

# 模块的核心思路

# 深入学习参考资料